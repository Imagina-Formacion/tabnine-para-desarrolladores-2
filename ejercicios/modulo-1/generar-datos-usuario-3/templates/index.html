<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Usuarios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Generador de Usuarios JSON</h1>
        
        <div class="input-group">
            <label for="user-count">Número de usuarios (1-20):</label>
            <input type="number" id="user-count" name="user-count" min="1" max="20" value="5">
        </div>
        
        <button id="generate-btn">Generar usuarios</button>
        
        <div id="message-area"></div>
        <pre id="json-output"></pre>
    </div>

    <script>
        document.getElementById('generate-btn').addEventListener('click', () => {
            const userCountInput = document.getElementById('user-count');
            const output = document.getElementById('json-output');
            const messageArea = document.getElementById('message-area');
            
            const count = parseInt(userCountInput.value, 10);

            // Validación en el cliente
            if (isNaN(count) || count < 1 || count > 20) {
                messageArea.textContent = 'Por favor, introduce un número entre 1 y 20.';
                messageArea.className = 'error';
                output.textContent = '';
                return;
            }

            messageArea.textContent = 'Generando...';
            messageArea.className = 'info';
            output.textContent = '';

            // Petición POST al backend
            fetch('/generate-users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ count: count }),
            })
            .then(response => {
                if (!response.ok) {
                    // Si la respuesta no es exitosa, lanza un error para ser capturado por .catch
                    return response.json().then(err => { throw new Error(err.error || 'Error en el servidor'); });
                }
                return response.json();
            })
            .then(data => {
                // Muestra el JSON formateado
                output.textContent = JSON.stringify(data, null, 2);
                messageArea.textContent = `Se generaron ${data.length} usuarios y se guardaron en la carpeta 'data'.`;
                messageArea.className = 'success';
            })
            .catch(error => {
                console.error('Error al generar usuarios:', error);
                messageArea.textContent = `Error: ${error.message}`;
                messageArea.className = 'error';
                output.textContent = '';
            });
        });
    </script>
</body>
</html>